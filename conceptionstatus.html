<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Conceive Score - Conception Stats</title>

<!-- Fonts & Chart.js -->
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --teal:#2b7a78;
  --teal-dark:#20575a;
  --muted:#6b6f72;
  --card-bg:#ffffff;
  --bg:#f0f4f8;
}
body{
  font-family: 'Montserrat', Arial, sans-serif;
  margin:0;
  background:var(--bg);
  display:flex;
  min-height:100vh;
}

/* Sidebar */
.sidebar{
  height:100vh;
  width:220px;
  background:var(--teal);
  color:white;
  display:flex;
  flex-direction:column;
  padding-top:18px;
  position:fixed;
}
.sidebar h2{ text-align:center; margin:8px 0 10px; font-size:20px; font-weight:700; }
.sidebar p{ text-align:center; margin:6px 8px; font-weight:500; }
.sidebar a{
  padding:10px 14px; text-decoration:none; color:white; display:flex; align-items:center;
  gap:10px; margin:6px; border-radius:8px; font-weight:500;
}
.sidebar a:hover{ background:var(--teal-dark); }

/* Navbar */
.navbar{
  position:fixed; top:0; left:220px; right:0; height:64px;
  background:var(--teal); display:flex; align-items:center;
  padding:0 18px; color:white; box-shadow:0 2px 6px rgba(0,0,0,0.12); z-index:100;
}
#welcomeMessage { margin-left:auto; margin-right:14px; font-weight:700; font-size:16px; }
.nav-icon{
  margin-left:8px; background:transparent; border:none; color:white; font-size:18px;
  width:44px; height:44px; border-radius:10px; cursor:pointer;
}
.nav-icon:hover{ background:var(--teal-dark); }

/* Main content */
.main-content{ margin-left:220px; padding:22px; flex:1; margin-top:80px; }
h1{ color:var(--teal); text-align:center; margin-bottom:25px; }

/* Stats cards */
.stats-grid{
  display:grid;
  grid-template-columns: repeat(auto-fill, minmax(250px,1fr));
  gap:18px;
  margin-bottom:25px;
}
.stat-card{
  background:var(--card-bg);
  padding:20px;
  border-radius:12px;
  box-shadow:0 6px 18px rgba(0,0,0,0.06);
  transition:transform 0.2s, box-shadow 0.2s;
}
.stat-card:hover{
  transform:translateY(-4px);
  box-shadow:0 12px 28px rgba(0,0,0,0.12);
}
.stat-card h3{ margin-top:0; color:var(--teal); }
.stat-card p{ color:var(--muted); font-size:14px; line-height:1.4; }

/* Charts section */
.charts-grid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:20px;
}
.chart-card{
  background:var(--card-bg);
  padding:16px;
  border-radius:12px;
  box-shadow:0 6px 18px rgba(0,0,0,0.06);
}
.chart-card h3{ margin:0 0 10px; color:var(--teal); }

/* Responsive */
@media(max-width:1000px){
  .charts-grid{ grid-template-columns:1fr; }
  .navbar{ left:0; }
  .sidebar{ display:none; }
  .main-content{ margin-left:0; margin-top:70px; padding:14px; }
}
</style>
</head>
<body>

<div class="sidebar">
  <h2>Conceive Score</h2>
  <p id="usernameDisplay">Guest</p>
  <a href="dashboard.html"><span>üè†</span> Dashboard</a>
  <a href="predict.html"><span>üìù</span> Add Cycle</a>
  <a href="history.html"><span>üìú</span> Cycle History</a>
  <a href="tips.html"><span>üí°</span> Tips & Guides</a>
  <a href="stats.html"><span>üìä</span> Conception Stats</a>
  <a href="#"><span>‚öôÔ∏è</span> Settings</a>
  <a href="#"><span>üîî</span> Notifications</a>
</div>

<div class="navbar">
  <div style="flex:1"></div>
  <div id="welcomeMessage">Welcome to Conceive Score</div>
  <button class="nav-icon" title="Dashboard" onclick="location.href='dashboard.html'">üè†</button>
  <button class="nav-icon" title="Predict" onclick="location.href='predict.html'">üìù</button>
  <button class="nav-icon" title="History" onclick="location.href='history.html'">üìú</button>
</div>

<div class="main-content">
  <h1>Conception Statistics</h1>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <div class="stat-card">
      <h3>Average Probability</h3>
      <p id="avgProbability">--%</p>
    </div>
    <div class="stat-card">
      <h3>Most Recent Cycle Probability</h3>
      <p id="latestProbability">--%</p>
    </div>
    <div class="stat-card">
      <h3>Total Predictions</h3>
      <p id="totalPredictions">--</p>
    </div>
    <div class="stat-card">
      <h3>Successful Conceptions</h3>
      <p id="successfulConceptions">--</p>
    </div>
  </div>

  <!-- Charts -->
  <div class="charts-grid">
    <div class="chart-card">
      <h3>Factors Affecting Conception</h3>
      <canvas id="factorsPie" height="220"></canvas>
    </div>
    <div class="chart-card">
      <h3>Cycle Probabilities</h3>
      <canvas id="probabilitiesBar" height="220"></canvas>
    </div>
  </div>
</div>

<script>
// Show username
const name = localStorage.getItem('patient_name') || 'Guest';
document.getElementById('usernameDisplay').textContent = name;
document.getElementById('welcomeMessage').textContent = `Welcome ${name} ‚Äî Conceive Score`;

// Load history
const history = JSON.parse(localStorage.getItem('prediction_history')||'[]');
const total = history.length;
let sumProb=0;
let lastProb=0;
let successful=0;

history.forEach(h=>{
  if(h.probability != null){
    sumProb += h.probability;
    lastProb = h.probability;
    if(h.successful) successful++;
  }
});

document.getElementById('avgProbability').textContent = total? Math.round((sumProb/total)*100)+'%' : '--%';
document.getElementById('latestProbability').textContent = total? Math.round(lastProb*100)+'%' : '--%';
document.getElementById('totalPredictions').textContent = total;
document.getElementById('successfulConceptions').textContent = successful;

// Pie chart for factors (example weights)
const ctxPie = document.getElementById('factorsPie').getContext('2d');
new Chart(ctxPie,{
  type:'pie',
  data:{
    labels:['Age','BMI','Hormones','Diet','Workout','Cycle Regularity'],
    datasets:[{
      data:[22,15,28,12,8,15],
      backgroundColor:['#ff9e9e','#ffd79e','#7cd39c','#7fb3ff','#b088f9','#ffe28a'],
      borderWidth:0
    }]
  },
  options:{
    responsive:true,
    plugins:{legend:{position:'bottom'}}
  }
});

// Bar chart for past probabilities
const ctxBar = document.getElementById('probabilitiesBar').getContext('2d');
new Chart(ctxBar,{
  type:'bar',
  data:{
    labels: history.map((h,i)=>`Cycle ${i+1}`),
    datasets:[{
      label:'Probability (%)',
      data: history.map(h=>Math.round(h.probability*100)),
      backgroundColor:'#7cd39c'
    }]
  },
  options:{
    responsive:true,
    scales:{
      y:{ beginAtZero:true, max:100 }
    }
  }
});
</script>

</body>
</html>
